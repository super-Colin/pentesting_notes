
## At this point we have some still obfuscated JS and some strange image links in the CSS

We'll come back to the image sources, but let's look into the JS first.

It's still pretty nasty to look at so I've run it through https://deobfuscate.io/ and then https://beautifier.io/ and put it in it's own file.

[Prettified JS](/examples/example1/prettified.js)

It's all contained in an anonymous function that will be executed automatically on loading the page. To see what actually happening we'll walk through it.

The first thing I see is defining a global (window.) dictionary called "_cf_chl_opt" with a bunch of weirdly name properties, and it seems to add a few more later, outside of the initial declaration.

Looking a little closer we can see some of the properties and values aren't as cryptic as they seemed at first glance.
- cZone: "cutt.ly" | a url shortening service that it will probably reach out to for more JS
- cHash: "7d2baf93083d0cb" | some kind of hash? key??
- cT: Math.floor(Date.now() / 1e3) | The time the site is visited

At this point I remembered hearing about using AI tools to summarize obfuscated code, so I threw in ChatGPT to see [what it could tell me](/examples/example1/prettified_gpt_summary.md). (ChatGPT is definitely not the best tool for this, there are now models trained for exactly this pupose, but ChatGPT is free...)

While not super helpful for things we didn't immediately know there was a useful snippet 
> "It creates a script element (cpo)"
> "it appends the dynamically created script element to the head"

Creating a new script element is one of a variety of methods to get the next block of JS to the client while keeping it off the website content, I would guess the image sources are doing something similar. (I think this is to prevent/delay being flagged as a malicious site in general, and/or to make it harder to reverse? Very unlikely they have an actual need for a CDN)

[Next day] I Decided to give chatGPT another shot and to my surprise it had some very helpful tips.

> In summary, replaceState() is used here to update the URL dynamically without triggering a page reload, allowing the script to append additional tracking parameters for analytics purposes and then revert back to the original URL after the necessary modifications are made.

Which tells us that even if we do land on a page with content, at a minimum we will have already been fingerprinted.

> To check if the content behind a challenge is malicious without directly visiting it in a browser, you can perform various analysis techniques...

Which helps assure us there's not much else we can do with our static analysis.



#TODO review image source payloads


### So we'll move onto [Intel Gathering](/intel/01_gathering_intel.md)!
